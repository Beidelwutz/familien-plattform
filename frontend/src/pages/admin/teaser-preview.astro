---
/**
 * Vorschau der Teaser-Box für das Admin-Dashboard (iframe).
 * 1:1 gleicher Aufbau und Look wie auf der Startseite (index.astro).
 */
import '../../styles/global.css';
import TeaserPreviewLayout from '../../layouts/TeaserPreviewLayout.astro';
import TagestippTeaserBox from '../../components/sections/TagestippTeaserBox.astro';

const q = Astro.url.searchParams;
const authorName = q.get('authorName') || 'Pepe';
const message = q.get('message') || 'Kurz mal raus: Spaziergang in der Günther-Klotz-Anlage – lohnt sich!';
const avatarSrc = q.get('avatarSrc') || 'https://i.pravatar.cc/96?u=pepe';
const countdownEndDate = q.get('countdownEndDate') || '2025-08-16T20:00:00';
const variant = Math.min(30, Math.max(1, parseInt(q.get('variant') || '7', 10))) as 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30;
const contentVariant = Math.min(30, Math.max(1, parseInt(q.get('contentVariant') || '16', 10))) as 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30;
const teaserLabel = q.get('teaserLabel') ?? '';
const teaserIcon = q.get('teaserIcon') ?? '';
const teaserThemeClass = q.get('teaserThemeClass') ?? '';
---

<TeaserPreviewLayout title="Teaser-Vorschau">
  <!-- 1:1 gleicher Wrapper wie index.astro (tagestipp-section + max-w + Box) -->
  <div class="tagestipp-section pt-3 px-[18px] pb-0 bg-tagestipp-bg">
    <div class="max-w-[1220px] mx-auto mb-2">
      <TagestippTeaserBox
        variant={variant}
        contentVariant={contentVariant}
        authorName={authorName}
        message={message}
        avatarSrc={avatarSrc}
        countdownEndDate={contentVariant === 16 ? countdownEndDate : undefined}
        labelPrefix={teaserLabel || undefined}
        icon={teaserIcon || undefined}
        themeClass={teaserThemeClass || undefined}
      />
    </div>
  </div>
  <!-- Astro-Dev-Toolbar in iframe ausblenden (nur in eingebetteter Vorschau) -->
  <script is:inline>
    (function() {
      if (typeof window === 'undefined' || window.self === window.top) return;
      function removeToolbar() {
        var t = document.querySelector('astro-dev-toolbar');
        if (t) { t.remove(); return true; }
        return false;
      }
      function run() {
        if (removeToolbar()) return;
        var obs = new MutationObserver(function() { if (removeToolbar()) obs.disconnect(); });
        obs.observe(document.body, { childList: true, subtree: true });
      }
      if (document.body) run(); else document.addEventListener('DOMContentLoaded', run);
    })();
  </script>
</TeaserPreviewLayout>
