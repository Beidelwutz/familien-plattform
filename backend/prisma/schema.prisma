generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [postgis, uuid_ossp(map: "uuid-ossp", schema: "extensions")]
}

model CanonicalEvent {
  id                      String                    @id @default(uuid())
  title                   String                    @db.VarChar(200)
  description_short       String?                   @db.VarChar(500)
  description_long        String?
  start_datetime          DateTime?                 @db.Timestamptz(6)
  end_datetime            DateTime?                 @db.Timestamptz(6)
  is_all_day              Boolean                   @default(false)
  location_address        String?                   @db.VarChar(300)
  location_district       String?                   @db.VarChar(100)
  location_lat            Decimal?                  @db.Decimal(10, 8)
  location_lng            Decimal?                  @db.Decimal(11, 8)
  venue_name              String?                   @db.VarChar(300)
  city                    String?                   @db.VarChar(100)
  postal_code             String?                   @db.VarChar(10)
  country_code            String?                   @db.VarChar(2)
  price_type              PriceType                 @default(unknown)
  price_min               Decimal?                  @db.Decimal(8, 2)
  price_max               Decimal?                  @db.Decimal(8, 2)
  price_details           Json?
  age_min                 Int?                      @db.SmallInt
  age_max                 Int?                      @db.SmallInt
  is_indoor               Boolean                   @default(false)
  is_outdoor              Boolean                   @default(false)
  booking_url             String?                   @db.VarChar(500)
  contact_email           String?                   @db.VarChar(200)
  contact_phone           String?                   @db.VarChar(50)
  image_urls              Json?                     @default("[]")
  primary_source_id       String?                   @unique
  merged_from             Json?                     @default("[]")
  provider_id             String?
  status                  EventStatus               @default(raw)
  is_complete             Boolean                   @default(false)
  is_verified             Boolean                   @default(false)
  completeness_score      Int?                      @db.SmallInt
  last_verified_at        DateTime?                 @db.Timestamptz(6)
  view_count              Int                       @default(0)
  save_count              Int                       @default(0)
  is_cancelled            Boolean                   @default(false)
  cancelled_at            DateTime?                 @db.Timestamptz(6)
  cancellation_reason     String?
  availability_status     String?                   @db.VarChar(30)
  recurrence_rule         String?                   @db.VarChar(200)
  next_occurrence_at      DateTime?                 @db.Timestamptz(6)
  rejection_reason        String?                   @db.VarChar(500)
  rescheduled_to_event_id String?
  previous_start_datetime DateTime?                 @db.Timestamptz(6)
  locked_fields           Json?                     @default("[]")
  field_provenance        Json?                     @default("{}")
  field_updated_at        Json?                     @default("{}")
  timezone_original       String?                   @db.VarChar(50)
  created_at              DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at              DateTime                  @updatedAt @db.Timestamptz(6)
  age_rating              String?                   @db.VarChar(10)
  published_by            PublishMethod?
  decision_reason         String?                   @db.VarChar(255)
  ai_flags                Json?                     @default("{}")
  field_fill_status       Json?                     @default("{}")
  ai_summary_short        String?                   @db.VarChar(300)
  ai_summary_highlights   Json?                     @default("[]")
  ai_fit_blurb            String?                   @db.VarChar(150)
  ai_summary_confidence   Decimal?                  @db.Decimal(3, 2)
  age_fit_0_2             Int?                      @db.SmallInt
  age_fit_3_5             Int?                      @db.SmallInt
  age_fit_6_9             Int?                      @db.SmallInt
  age_fit_10_12           Int?                      @db.SmallInt
  age_fit_13_15           Int?                      @db.SmallInt
  location_point          Unsupported("geography")?
  primary_source          EventSource?              @relation("PrimarySource", fields: [primary_source_id], references: [id])
  provider                Provider?                 @relation(fields: [provider_id], references: [id])
  rescheduled_to          CanonicalEvent?           @relation("RescheduledTo", fields: [rescheduled_to_event_id], references: [id])
  rescheduled_from        CanonicalEvent[]          @relation("RescheduledTo")
  dup_candidates_a        DupCandidate[]            @relation("DupCandidateA")
  dup_candidates_b        DupCandidate[]            @relation("DupCandidateB")
  amenities               EventAmenity[]
  categories              EventCategory[]
  revisions               EventRevision[]
  scores                  EventScore?
  event_sources           EventSource[]             @relation("CanonicalEventSources")
  plan_slots              PlanSlot[]
  raw_event_items         RawEventItem[]
  saved_by                SavedEvent[]

  @@index([status, start_datetime])
  @@index([start_datetime])
  @@index([provider_id])
  @@index([is_cancelled])
  @@index([age_rating])
  @@index([location_point], type: Gist)
  @@map("canonical_events")
}

model EventScore {
  event_id         String         @id
  relevance_score  Int?           @db.SmallInt
  quality_score    Int?           @db.SmallInt
  family_fit_score Int?           @db.SmallInt
  stressfree_score Int?           @db.SmallInt
  confidence       Decimal?       @db.Decimal(3, 2)
  ai_model_version String?        @db.VarChar(50)
  ai_reasoning     Json?
  scored_at        DateTime       @default(now()) @db.Timestamptz(6)
  fun_score        Int?           @db.SmallInt
  event            CanonicalEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@map("event_scores")
}

model EventSource {
  id                 String          @id @default(uuid())
  canonical_event_id String?
  source_id          String
  external_id        String?         @db.VarChar(255)
  source_url         String?         @db.VarChar(500)
  raw_data           Json?
  normalized_data    Json?
  fingerprint        String?         @db.VarChar(32)
  fetched_at         DateTime        @default(now()) @db.Timestamptz(6)
  updated_at         DateTime        @updatedAt @db.Timestamptz(6)
  primary_for        CanonicalEvent? @relation("PrimarySource")
  canonical_event    CanonicalEvent? @relation("CanonicalEventSources", fields: [canonical_event_id], references: [id])
  source             Source          @relation(fields: [source_id], references: [id])

  @@unique([source_id, external_id])
  @@unique([fingerprint, source_id], name: "event_sources_fingerprint_source_unique")
  @@index([fingerprint])
  @@index([canonical_event_id])
  @@map("event_sources")
}

model Source {
  id                       String            @id @default(uuid())
  name                     String            @db.VarChar(200)
  type                     SourceType
  url                      String?           @db.VarChar(500)
  schedule_cron            String?           @db.VarChar(50)
  last_fetch_at            DateTime?         @db.Timestamptz(6)
  next_fetch_at            DateTime?         @db.Timestamptz(6)
  last_success_at          DateTime?         @db.Timestamptz(6)
  last_failure_at          DateTime?         @db.Timestamptz(6)
  is_active                Boolean           @default(true)
  consecutive_failures     Int               @default(0)
  health_status            HealthStatus      @default(unknown)
  avg_events_per_fetch     Float?
  expected_event_count_min Int?
  scrape_allowed           Boolean           @default(true)
  rate_limit_ms            Int               @default(5000)
  priority                 Int               @default(3)
  scraper_config           Json?
  source_etag              String?           @db.VarChar(255)
  source_last_modified     DateTime?         @db.Timestamptz(6)
  notes                    String?
  created_at               DateTime          @default(now()) @db.Timestamptz(6)
  updated_at               DateTime          @updatedAt @db.Timestamptz(6)
  event_sources            EventSource[]
  ingest_runs              IngestRun[]
  raw_event_items          RawEventItem[]
  compliance               SourceCompliance?
  fetch_logs               SourceFetchLog[]

  @@map("sources")
}

model SourceCompliance {
  source_id             String            @id
  robots_txt_checked_at DateTime?         @db.Timestamptz(6)
  robots_txt_allows     Boolean?
  tos_reviewed_at       DateTime?         @db.Timestamptz(6)
  tos_allows_scraping   Boolean?
  contact_attempted     Boolean           @default(false)
  partnership_status    PartnershipStatus @default(none)
  legal_notes           String?
  updated_at            DateTime          @updatedAt @db.Timestamptz(6)
  source                Source            @relation(fields: [source_id], references: [id], onDelete: Cascade)

  @@map("source_compliance")
}

model SourceFetchLog {
  id                  String      @id @default(uuid())
  source_id           String
  started_at          DateTime    @default(now()) @db.Timestamptz(6)
  finished_at         DateTime?   @db.Timestamptz(6)
  status              FetchStatus @default(running)
  events_found        Int?
  events_new          Int?
  events_updated      Int?
  error_message       String?
  http_status_code    Int?
  response_size_bytes Int?
  source              Source      @relation(fields: [source_id], references: [id], onDelete: Cascade)

  @@index([source_id, started_at])
  @@map("source_fetch_logs")
}

model GeocodeCache {
  address_hash       String   @id @db.VarChar(64)
  original_address   String
  normalized_address String?
  lat                Decimal  @db.Decimal(10, 8)
  lng                Decimal  @db.Decimal(11, 8)
  confidence         Decimal? @db.Decimal(3, 2)
  provider           String   @db.VarChar(50)
  district_canonical String?  @db.VarChar(100)
  created_at         DateTime @default(now()) @db.Timestamptz(6)

  @@map("geocode_cache")
}

model DistrictAlias {
  id             String   @id @default(uuid())
  canonical_name String   @unique @db.VarChar(100)
  aliases        Json     @default("[]")
  center_lat     Decimal? @db.Decimal(10, 8)
  center_lng     Decimal? @db.Decimal(11, 8)

  @@map("district_aliases")
}

model AICache {
  content_hash          String   @id @db.VarChar(64)
  model_version         String   @db.VarChar(50)
  classification_result Json?
  scores                Json?
  created_at            DateTime @default(now()) @db.Timestamptz(6)
  expires_at            DateTime @db.Timestamptz(6)
  hit_count             Int      @default(0)

  @@index([expires_at])
  @@map("ai_cache")
}

model AIUsageLog {
  id                  String   @id @default(uuid())
  timestamp           DateTime @default(now()) @db.Timestamptz(6)
  model               String   @db.VarChar(50)
  operation           String   @db.VarChar(50)
  input_tokens        Int?
  output_tokens       Int?
  estimated_cost_usd  Decimal? @db.Decimal(10, 6)
  price_input_per_1k  Decimal? @db.Decimal(10, 6)
  price_output_per_1k Decimal? @db.Decimal(10, 6)
  pricing_version     String?  @db.VarChar(20)
  event_id            String?
  user_id             String?
  request_id          String?  @db.VarChar(50)
  response_time_ms    Int?
  was_cached          Boolean  @default(false)
  error_code          String?  @db.VarChar(50)

  @@index([timestamp])
  @@index([model, operation])
  @@index([event_id])
  @@map("ai_usage_log")
}

model Category {
  id            String          @id @default(uuid())
  slug          String          @unique @db.VarChar(50)
  name_de       String          @db.VarChar(100)
  icon          String?         @db.VarChar(10)
  sort_order    Int             @default(0)
  parent_id     String?
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  updated_at    DateTime        @updatedAt @db.Timestamptz(6)
  updated_by_id String?
  parent        Category?       @relation("CategoryHierarchy", fields: [parent_id], references: [id])
  children      Category[]      @relation("CategoryHierarchy")
  updated_by    User?           @relation("CategoryUpdatedBy", fields: [updated_by_id], references: [id])
  events        EventCategory[]

  @@index([parent_id, sort_order])
  @@map("categories")
}

model EventCategory {
  event_id    String
  category_id String
  category    Category       @relation(fields: [category_id], references: [id], onDelete: Cascade)
  event       CanonicalEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@id([event_id, category_id])
  @@map("event_categories")
}

model Amenity {
  id            String         @id @default(uuid())
  slug          String         @unique @db.VarChar(50)
  name_de       String         @db.VarChar(100)
  icon          String?        @db.VarChar(10)
  sort_order    Int            @default(0)
  created_at    DateTime       @default(now()) @db.Timestamptz(6)
  updated_at    DateTime       @updatedAt @db.Timestamptz(6)
  updated_by_id String?
  updated_by    User?          @relation("AmenityUpdatedBy", fields: [updated_by_id], references: [id])
  events        EventAmenity[]

  @@index([sort_order])
  @@map("amenities")
}

model EventAmenity {
  event_id     String
  amenity_id   String
  is_confirmed Boolean        @default(false)
  amenity      Amenity        @relation(fields: [amenity_id], references: [id], onDelete: Cascade)
  event        CanonicalEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@id([event_id, amenity_id])
  @@map("event_amenities")
}

model Provider {
  id                String           @id @default(uuid())
  name              String           @db.VarChar(200)
  type              ProviderType
  website           String?          @db.VarChar(500)
  email             String?          @db.VarChar(200)
  phone             String?          @db.VarChar(50)
  address           String?          @db.VarChar(300)
  lat               Decimal?         @db.Decimal(10, 8)
  lng               Decimal?         @db.Decimal(11, 8)
  logo_url          String?          @db.VarChar(500)
  subscription_tier SubscriptionTier @default(free)
  is_verified       Boolean          @default(false)
  verified_at       DateTime?        @db.Timestamptz(6)
  user_id           String?          @unique
  created_at        DateTime         @default(now()) @db.Timestamptz(6)
  updated_at        DateTime         @updatedAt @db.Timestamptz(6)
  events            CanonicalEvent[]
  user              User?            @relation(fields: [user_id], references: [id])

  @@map("providers")
}

model User {
  id                    String               @id @default(uuid())
  email                 String               @unique @db.VarChar(255)
  password_hash         String?              @db.VarChar(255)
  role                  UserRole             @default(parent)
  email_verified        Boolean              @default(false)
  email_verified_at     DateTime?            @db.Timestamptz(6)
  failed_login_attempts Int                  @default(0)
  locked_until          DateTime?            @db.Timestamptz(6)
  last_login_at         DateTime?            @db.Timestamptz(6)
  created_at            DateTime             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime             @updatedAt @db.Timestamptz(6)
  admin_audit_logs      AdminAuditLog[]      @relation("AdminAuditLogs")
  amenities_updated     Amenity[]            @relation("AmenityUpdatedBy")
  categories_updated    Category[]           @relation("CategoryUpdatedBy")
  dup_resolutions       DupCandidate[]
  revisions_created     EventRevision[]      @relation("RevisionCreator")
  revisions_reviewed    EventRevision[]      @relation("RevisionReviewer")
  family_profile        FamilyProfile?
  password_reset_tokens PasswordResetToken[]
  plans                 Plan[]
  provider              Provider?
  saved_events          SavedEvent[]

  @@index([email_verified])
  @@map("users")
}

model PasswordResetToken {
  id         String    @id @default(uuid())
  user_id    String
  token_hash String    @db.VarChar(255)
  expires_at DateTime  @db.Timestamptz(6)
  used_at    DateTime? @db.Timestamptz(6)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([token_hash])
  @@index([expires_at])
  @@map("password_reset_tokens")
}

model FamilyProfile {
  id                   String   @id @default(uuid())
  user_id              String   @unique
  children_ages        Json?    @default("[]")
  preferred_radius_km  Int?     @db.SmallInt
  preferred_categories Json?    @default("[]")
  home_lat             Decimal? @db.Decimal(10, 8)
  home_lng             Decimal? @db.Decimal(11, 8)
  updated_at           DateTime @updatedAt @db.Timestamptz(6)
  user                 User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("family_profiles")
}

model SavedEvent {
  user_id  String
  event_id String
  saved_at DateTime       @default(now()) @db.Timestamptz(6)
  event    CanonicalEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)
  user     User           @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, event_id])
  @@map("saved_events")
}

model Plan {
  id            String     @id @default(uuid())
  user_id       String?
  title         String?    @db.VarChar(200)
  date          DateTime   @db.Date
  children_ages Json?      @default("[]")
  budget        Decimal?   @db.Decimal(8, 2)
  preferences   Json?
  route_data    Json?
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  plan_b_slots  PlanSlot[] @relation("PlanBSlots")
  slots         PlanSlot[]
  user          User?      @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("plans")
}

model PlanSlot {
  id               String          @id @default(uuid())
  plan_id          String
  plan_b_for_id    String?
  event_id         String?
  slot_type        SlotType        @default(activity)
  start_time       DateTime        @db.Timestamptz(6)
  end_time         DateTime        @db.Timestamptz(6)
  duration_minutes Int
  notes            String?
  event            CanonicalEvent? @relation(fields: [event_id], references: [id])
  plan_b_for       Plan?           @relation("PlanBSlots", fields: [plan_b_for_id], references: [id])
  plan             Plan            @relation(fields: [plan_id], references: [id], onDelete: Cascade)

  @@index([plan_id])
  @@map("plan_slots")
}

model EventRevision {
  id               String         @id @default(uuid())
  event_id         String
  changeset        Json
  created_by       String?
  created_at       DateTime       @default(now()) @db.Timestamptz(6)
  status           RevisionStatus @default(pending)
  reviewed_by      String?
  reviewed_at      DateTime?      @db.Timestamptz(6)
  review_note      String?
  created_by_user  User?          @relation("RevisionCreator", fields: [created_by], references: [id])
  event            CanonicalEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)
  reviewed_by_user User?          @relation("RevisionReviewer", fields: [reviewed_by], references: [id])

  @@index([event_id])
  @@index([status])
  @@map("event_revisions")
}

model IngestRun {
  id               String         @id @default(uuid())
  correlation_id   String         @db.VarChar(50)
  source_id        String?
  started_at       DateTime       @default(now()) @db.Timestamptz(6)
  finished_at      DateTime?      @db.Timestamptz(6)
  status           IngestStatus   @default(running)
  events_found     Int            @default(0)
  events_created   Int            @default(0)
  events_updated   Int            @default(0)
  events_skipped   Int            @default(0)
  events_unchanged Int            @default(0)
  events_ignored   Int            @default(0)
  merge_stats      Json?
  error_message    String?
  error_details    Json?
  retry_count      Int            @default(0)
  needs_attention  Boolean        @default(false)
  acknowledged_at  DateTime?      @db.Timestamptz(6)
  source           Source?        @relation(fields: [source_id], references: [id])
  raw_event_items  RawEventItem[]

  @@index([status])
  @@index([needs_attention])
  @@index([source_id, started_at])
  @@map("ingest_runs")
}

model RawEventItem {
  id                 String          @id @default(uuid())
  source_id          String
  run_id             String
  raw_hash           String          @db.VarChar(64)
  raw_payload        Json?
  extracted_fields   Json
  source_url         String          @db.VarChar(500)
  external_id        String?         @db.VarChar(255)
  fingerprint        String          @db.VarChar(32)
  parser_version     String          @db.VarChar(20)
  normalizer_version String          @db.VarChar(20)
  ai_suggestions     Json?
  canonical_event_id String?
  ingest_status      String?         @db.VarChar(20)
  ingest_result      Json?
  first_seen_at      DateTime        @default(now()) @db.Timestamptz(6)
  last_seen_at       DateTime        @default(now()) @db.Timestamptz(6)
  seen_count         Int             @default(1)
  fetched_at         DateTime        @db.Timestamptz(6)
  created_at         DateTime        @default(now()) @db.Timestamptz(6)
  canonical_event    CanonicalEvent? @relation(fields: [canonical_event_id], references: [id])
  run                IngestRun       @relation(fields: [run_id], references: [id])
  source             Source          @relation(fields: [source_id], references: [id])

  @@unique([source_id, raw_hash])
  @@index([run_id])
  @@index([source_id, fetched_at])
  @@index([fingerprint])
  @@index([canonical_event_id])
  @@map("raw_event_items")
}

model DupCandidate {
  id               String         @id @default(uuid())
  event_a_id       String
  event_b_id       String
  confidence       DupConfidence
  score            Decimal?       @db.Decimal(3, 2)
  detected_at      DateTime       @default(now()) @db.Timestamptz(6)
  resolved_at      DateTime?      @db.Timestamptz(6)
  resolution       DupResolution?
  resolved_by      String?
  event_a          CanonicalEvent @relation("DupCandidateA", fields: [event_a_id], references: [id], onDelete: Cascade)
  event_b          CanonicalEvent @relation("DupCandidateB", fields: [event_b_id], references: [id], onDelete: Cascade)
  resolved_by_user User?          @relation(fields: [resolved_by], references: [id])

  @@unique([event_a_id, event_b_id])
  @@index([confidence])
  @@index([resolution])
  @@map("dup_candidates")
}

model SearchQueryLog {
  id        String   @id @default(cuid())
  queryNorm String   @db.VarChar(120)
  city      String?  @db.VarChar(80)
  createdAt DateTime @default(now()) @db.Timestamptz(6)

  @@index([city, createdAt])
  @@index([queryNorm])
  @@map("search_query_logs")
}

model TrendingTerm {
  id          String   @id @default(cuid())
  term        String   @db.VarChar(120)
  city        String?  @db.VarChar(80)
  score       Float
  trendRatio  Float
  searches24h Int
  baseline7d  Float
  computedAt  DateTime @default(now()) @db.Timestamptz(6)

  @@index([city, score])
  @@index([computedAt])
  @@map("trending_terms")
}

model TrendOverride {
  id          String      @id @default(cuid())
  term        String      @db.VarChar(120)
  termNorm    String      @db.VarChar(120)
  city        String?     @db.VarChar(80)
  action      TrendAction
  boost       Int?
  replacement String?     @db.VarChar(120)
  label       String?     @db.VarChar(50)
  startsAt    DateTime?   @db.Timestamptz(6)
  endsAt      DateTime?   @db.Timestamptz(6)
  priority    Int         @default(0)
  isActive    Boolean     @default(true)
  createdById String?
  createdAt   DateTime    @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime    @updatedAt @db.Timestamptz(6)

  @@unique([termNorm, city, action], name: "unique_override_per_action")
  @@index([city, isActive])
  @@index([startsAt, endsAt])
  @@index([action])
  @@map("trend_overrides")
}

model AdminAuditLog {
  id          String      @id @default(cuid())
  timestamp   DateTime    @default(now()) @db.Timestamptz(6)
  user_id     String
  action      AuditAction
  entity_type String      @db.VarChar(50)
  entity_id   String      @db.VarChar(50)
  entity_name String?     @db.VarChar(200)
  changes     Json?
  metadata    Json?
  ip_address  String?     @db.VarChar(45)
  user_agent  String?     @db.VarChar(500)
  user        User        @relation("AdminAuditLogs", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([timestamp])
  @@index([entity_type, entity_id])
  @@index([action])
  @@map("admin_audit_logs")
}

model JobQueueEntry {
  id            String    @id @default(cuid())
  job_type      String    @db.VarChar(50)
  job_key       String    @db.VarChar(200)
  status        JobStatus @default(QUEUED)
  priority      Int       @default(0)
  payload       Json
  scheduled_at  DateTime  @default(now()) @db.Timestamptz(6)
  started_at    DateTime? @db.Timestamptz(6)
  completed_at  DateTime? @db.Timestamptz(6)
  result        Json?
  error_message String?
  attempts      Int       @default(0)
  created_by_id String?
  created_at    DateTime  @default(now()) @db.Timestamptz(6)

  @@unique([job_type, job_key])
  @@index([status, priority, scheduled_at])
  @@index([job_type, status])
  @@map("job_queue")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

enum EventStatus {
  raw
  incomplete
  pending_ai
  pending_review
  published
  stale
  archived
  rejected
  cancelled
}

enum PriceType {
  free
  paid
  range
  donation
  unknown
}

enum AvailabilityStatus {
  available
  sold_out
  waitlist
  registration_required
  unknown
}

enum ComplexityLevel {
  simple
  moderate
  advanced
}

enum NoiseLevel {
  quiet
  moderate
  loud
}

enum PublishMethod {
  ai_auto
  human_review
  provider_direct
}

enum SourceType {
  api
  rss
  ics
  scraper
  partner
  manual
}

enum HealthStatus {
  healthy
  degraded
  failing
  dead
  unknown
}

enum PartnershipStatus {
  none
  pending
  agreed
  rejected
}

enum FetchStatus {
  running
  success
  partial
  error
}

enum ProviderType {
  verein
  unternehmen
  kommune
  kita
  freiberuflich
  sonstiges
}

enum SubscriptionTier {
  free
  basic
  pro
}

enum UserRole {
  parent
  provider
  admin
}

enum SlotType {
  activity
  break
  travel
}

enum RevisionStatus {
  pending
  approved
  rejected
}

enum IngestStatus {
  running
  success
  partial
  failed
}

enum DupConfidence {
  exact
  likely
  maybe
}

enum DupResolution {
  merged
  different
  ignored
}

enum TrendAction {
  PIN
  BOOST
  HIDE
  REPLACE
  PUSH
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  REORDER
  MERGE
  APPROVE
  REJECT
  CONFIRM
}

enum JobStatus {
  QUEUED
  RUNNING
  SUCCESS
  FAILED
}

enum AiJobStatus {
  running
  completed
  failed
  stale
  cancelled
}

model AiJob {
  id               String      @id @default(uuid())
  status           AiJobStatus @default(running)
  total            Int
  processed        Int         @default(0)
  current_event_id String?
  started_at       DateTime    @default(now()) @db.Timestamptz(6)
  last_heartbeat   DateTime    @default(now()) @db.Timestamptz(6)
  completed_at     DateTime?   @db.Timestamptz(6)
  summary          Json?       // { published, pending_review, rejected, failed, incomplete, archived }
  total_cost_usd   Float       @default(0)
  created_by       String?

  @@index([status])
  @@index([started_at])
  @@index([last_heartbeat])
  @@map("ai_jobs")
}
